import networkx as nx
import numpy as np
from typing import Dict, Tuple

class RelationalReciprocityNetwork:
    def __init__(self):
        self.G = nx.DiGraph()  # directed graph for asymmetric obligations

    def add_relational_unit(self, agent1: str, agent2: str, context: str, 
                           obligation_strength: float = 1.0):
        """Add reciprocal edge pair representing one relational unit."""
        self.G.add_edge(agent1, agent2, 
                        context=context, 
                        obligation=obligation_strength)
        self.G.add_edge(agent2, agent1, 
                        context=context, 
                        obligation=obligation_strength)

    def update_reciprocity(self, agent: str, input_strength: float = 1.0):
        """Simple observer-corrected update: strengthen reciprocal edges."""
        for neighbor in list(self.G.neighbors(agent)):
            if self.G.has_edge(neighbor, agent):
                current = self.G[agent][neighbor]['obligation']
                new = current * (1 + 0.05 * input_strength)  # small reinforcement
                self.G[agent][neighbor]['obligation'] = min(1.0, new)
                self.G[neighbor][agent]['obligation'] = min(1.0, new)

    def reciprocity_score(self) -> float:
        """Mean reciprocal obligation strength across all paired edges."""
        scores = []
        for u, v, data in self.G.edges(data=True):
            if self.G.has_edge(v, u):
                scores.append(data['obligation'] * self.G[v][u]['obligation'])
        return np.mean(scores) if scores else 0.0

# Example usage (hunter-caribou-land system)
rrn = RelationalReciprocityNetwork()
rrn.add_relational_unit('hunter', 'caribou', 'hunt', 1.0)
rrn.add_relational_unit('hunter', 'land', 'stewardship', 0.8)
rrn.add_relational_unit('caribou', 'land', 'graze', 0.9)

print("Initial reciprocity score:", rrn.reciprocity_score())

# Simulate 10 cycles of interaction (observer input)
for cycle in range(10):
    rrn.update_reciprocity('hunter', input_strength=1.0)
    print(f"Cycle {cycle+1}: {rrn.reciprocity_score():.4f}")